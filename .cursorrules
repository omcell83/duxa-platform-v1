
# DUXA PLATFORM - SECURITY & CODING MANIFESTO

You are creating a high-security, offline-first restaurant SaaS called "Duxa".
Prioritize STABILITY, SECURITY, and TYPE SAFETY over speed.

## 0. GOLDEN RULE: ZERO BUILD ERRORS (STRICT MODE)
- **Verify Before Output:** Never output code without mentally (or actually) verifying it against TypeScript rules.
- **Type-Check:** When using Composer (Agent), always run `npm run type-check` (or `tsc --noEmit`) before finishing. If there are errors, FIX THEM automatically.
- **No `any`:** Strict TypeScript is non-negotiable. Define proper interfaces for all data.
- **No Hallucinations:** Do not import non-existent libraries or assume file paths. Check first.

## 1. SECURITY RULES (NON-NEGOTIABLE)
- **RLS Awareness:** Every database query MUST respect Supabase Row Level Security.
- **Tenant Isolation:** Always filter queries by `tenant_id`. Never allow cross-tenant data leaks.
- **Input Validation:** Use `zod` to validate ALL user inputs on both client and server.
- **No Secrets in Code:** Never hardcode API keys. Use `process.env`.
- **SQL Injection:** Use parameterized queries via Supabase SDK.

## 2. ARCHITECTURE (HYBRID)
- **Web App (Next.js):** Runs on Cloud (Coolify). Uses Supabase directly.
- **Kiosk App (Electron):** Runs Offline. Uses local SQLite encrypted with SQLCipher.
- **Sync Engine:** Kiosk syncs to Supabase when online.

## 3. ERROR HANDLING & SELF-HEALING
- Wrap critical async operations in try/catch blocks.
- If an API fails, the UI must show a user-friendly "Offline" or "Error" state, never crash (White Screen of Death).
- Use React Error Boundaries for component isolation.

## 4. TECH STACK
- **Framework:** Next.js 14+ (App Router) - Strict separation of Server/Client Components.
- **Language:** TypeScript (Strict).
- **Styling:** Tailwind CSS, Shadcn UI.
- **State:** Zustand (Client), TanStack Query (Server State).
- **DB:** Supabase (Cloud), SQLite (Local).


## 5. UI/UX DESIGN SYSTEM (THEME)
- **Component Library:** Use **Shadcn UI** for ALL interactive elements (Buttons, Inputs, Modals, Tabs). Do not build from scratch.
- **Colors:**
  - Use `bg-primary` for main actions (Save, Submit).
  - Use `bg-secondary` for highlights or secondary actions.
  - Use `bg-destructive` for dangerous actions (Delete, Suspend).
  - Use `bg-muted` for disabled states or secondary info.
  - Use `bg-card` for containers/panels.
  - Use `bg-popover` for Modals and Dropdowns (Must be opaque).
- **Layout:**
  - Use `container mx-auto` for page widths.
  - Use `gap-4` or `gap-6` for consistent spacing.
  - Use `rounded-lg` (radius variable) for borders.
- **Dark Mode:** All UI code MUST support Dark Mode automatically by using the semantic classes above.
